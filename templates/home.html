<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>MPRIS web remote</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <style>
        body {
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 2rem;
            background-color: #333;
            color: #fff;
            text-align: center;
        }

        button {
            background-color: #80c23e;
            border: none;
            border-radius: 50%;
            width: 100%;
            padding: 0;
            color: #111111;
        }

        button svg {
            height: 100%;
            width: 100%;
        }

        body[data-state=""] button {
            display: none;
        }

        body[data-state]:not([data-state=""]) section {
            display: none;
        }

        body[data-state="paused"] svg#play,
        body[data-state="stopped"] svg#play {
            display: none;
        }

        body[data-state="playing"] svg#pause {
            display: none;
        }
    </style>
    <script type="module">
        const body = document.querySelector('body');

        document.querySelector('button').addEventListener('click', () => {
            const data = new URLSearchParams();

            data.append('action', body.dataset.state === 'playing' ? 'pause' : 'play');

            fetch('{{ url_for('change_state') }}', {
                    method: 'post',
                    body: data
                })
                .then(response => response.json())
                .then(data => {
                    body.dataset.state = data.new_state ?? '';
                });
        });

        /*const eventSource = new EventSource('{{ url_for('updates') }}');

        eventSource.addEventListener('state-changed', e => {
            body.dataset.state = e.data;
        });*/
    </script>
</head>
<body data-state="{{ current_state or '' }}">
    {% if message %}
        <section>
            {{ message }}
        </section>
    {% endif %}

    <button type="button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" id="play">
            <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"/>
        </svg>

        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" id="pause">
            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>
        </svg>
   </button>
</body>
</html>